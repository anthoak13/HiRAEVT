CFLAGS    :=`root-config --cflags --libs`
SYSLIB    := -lz -l TreePlayer -lMathMore

DllSuf    := so
SrcSuf    := cxx
ObjSuf    := o
PcmSuf    := _rdict.pcm

INCLUDES  := -I$(HiRAEVTSRC)/
INCLUDES  += -I$(HiRAEVTSRC)/HTRootElectronics
INCLUDES  += -I$(HiRAEVTSRC)/HTDetectorMap
INCLUDES  += -I$(HiRAEVTSRC)/detectors/HTDetector
INCLUDES  += -I$(HiRAEVTSRC)/detectors/HTSisTimestampe15190

RLIBS     := -L$(HiRAEVTLIB) -lHTDetector

CXXFLAGS  += $(INCLUDES) -std=c++11 -fPIC -O3 -Wall

HTTSISTIMESTAMPE15190_DICT  := HTSisTimestampe15190Dict.$(SrcSuf)
HTTSISTIMESTAMPE15190_DICTH := $(HTTSISTIMESTAMPE15190_DICT:.$(SrcSuf)=.h)
HTTSISTIMESTAMPE15190_DICTO := $(HTTSISTIMESTAMPE15190_DICT:.$(SrcSuf)=.$(ObjSuf))
HTTSISTIMESTAMPE15190_PCM   := HTSisTimestampe15190Dict$(PcmSuf)

HTTSISTIMESTAMPE15190_HDRS  := $(wildcard HT*.$(SrcSuf))

HTTSISTIMESTAMPE15190_HDRS  := $(HTTSISTIMESTAMPE15190_HDRS:.$(SrcSuf)=.h) HTSisTimestampe15190LinkDef.h
HTTSISTIMESTAMPE15190_HDRS  := $(filter-out $(HTTSISTIMESTAMPE15190_DICTH),$(HTTSISTIMESTAMPE15190_HDRS))

HTTSISTIMESTAMPE15190_LIB := libHTSisTimestampe15190.$(DllSuf)
SRCS = $(wildcard *.$(SrcSuf))
OBJS = $(patsubst %.$(SrcSuf), %.$(ObjSuf), $(SRCS))

.$(SrcSuf).$(ObjSuf):
	@$(CXX) $(CXXFLAGS) -c $< $(SYSLIB) $(CFLAGS)
	@echo "$(CXX) $(CXXFLAGS) -c $< $(SYSLIB) $(CFLAGS)"

all: $(HTTSISTIMESTAMPE15190_LIB)

.SUFFIXES: .$(SrcSuf) .$(ObjSuf) .$(DllSuf) .$(PcmSuf)

$(HTTSISTIMESTAMPE15190_DICT): $(HTTSISTIMESTAMPE15190_HDRS)
	@echo "Generating dictionary $@..."
	$(ROOTCLINGORCINT) -f $@ -p $(INCLUDES) $^

$(HTTSISTIMESTAMPE15190_LIB): $(OBJS) $(HTTSISTIMESTAMPE15190_DICTO)
	@$(CXX) -shared $(CXXFLAGS) $^ $(SYSLIB) $(CFLAGS) $(RLIBS) -o $@
	@echo "$(CXX) -shared $(CXXFLAGS) $^ $(SYSLIB) $(CFLAGS) $(RLIBS) -o $@"

install:
	@cp $(HTTSISTIMESTAMPE15190_LIB) $(HTTSISTIMESTAMPE15190_PCM) $(HiRAEVTLIB)/.

.PHONY: distclean
distclean:
	@rm -f $(HTTSISTIMESTAMPE15190_LIB) $(HTTSISTIMESTAMPE15190_DICT) $(HTTSISTIMESTAMPE15190_DICTH) $(HTTSISTIMESTAMPE15190_PCM)
	@rm -f $(HiRAEVTLIB)/$(HTTSISTIMESTAMPE15190_LIB)

.PHONY: clean
clean:
	@$(RM) -f $(LIB) $(OBJS) $(HTTSISTIMESTAMPE15190_DICTO) $(HTTSISTIMESTAMPE15190_DICT) $(HTTSISTIMESTAMPE15190_DICTH) $(HTTSISTIMESTAMPE15190_PCM)
	@$(RM) -f *.expand

.PHONY: lint
lint:
	$(LINT) $(INC_SRCH_PATH) $(SRCS)
